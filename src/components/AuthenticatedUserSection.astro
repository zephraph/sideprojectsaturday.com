---
import { actions } from "astro:actions";

interface Props {
    user: {
        name?: string;
        email: string;
        interestedInFutureEvents?: boolean;
        rsvpedForNextEvent?: boolean;
    };
}

const { user } = Astro.props;
---

<div>
    <h3 class="text-xl font-bold text-gray-800 mb-3 text-center">
        Welcome back, {user.name || user.email}!
    </h3>
    <div class="space-y-3">
        <div id="rsvp-section" class="bg-green-50 border border-green-200 rounded-md p-3">
            <div class="text-sm font-medium text-green-800 mb-2">
                Next Event RSVP
            </div>
            <div class="flex items-center justify-between">
                <span class="text-green-700 text-sm">
                    {
                        user.rsvpedForNextEvent
                            ? "‚úÖ You're RSVP'd!"
                            : "‚ùå Not RSVP'd"
                    }
                </span>
                <form 
                    hx-post="/api/rsvp-toggle"
                    hx-target="#rsvp-section"
                    hx-swap="outerHTML"
                >
                    <input
                        type="hidden"
                        name="rsvpedForNextEvent"
                        value={user.rsvpedForNextEvent ? "false" : "true"}
                    />
                    <button
                        type="submit"
                        class="text-xs text-green-600 hover:text-green-800 font-medium underline cursor-pointer"
                    >
                        {user.rsvpedForNextEvent ? "Cancel RSVP" : "RSVP Now"}
                    </button>
                </form>
            </div>
        </div>

        <div class="bg-blue-50 border border-blue-200 rounded-md p-3">
            <div class="text-sm font-medium text-blue-800">Event Details</div>
            <div class="text-blue-700 text-sm mt-1">
                üìç Location: 325 Gold Street, Brooklyn, NY Studio 501<br />
                ‚è∞ Time: 9:00 AM - 12:00 PM<br />
            </div>
        </div>

        <div class="bg-amber-50 border border-amber-200 rounded-md p-3">
            <div class="text-sm font-medium text-amber-800">What to Bring</div>
            <div class="text-amber-700 text-sm mt-1">
                üíª Your laptop<br />
                üí° A project idea<br />
                ‚òï Good vibes!
            </div>
        </div>

        <div id="subscription-section" class="bg-purple-50 border border-purple-200 rounded-md p-3">
            <div class="text-sm font-medium text-purple-800 mb-2">
                Event Notifications
            </div>
            <div class="flex items-center justify-between">
                <span class="text-purple-700 text-sm">
                    {
                        user.interestedInFutureEvents !== false
                            ? "üìß Subscribed to future events"
                            : "üîï Unsubscribed from future events"
                    }
                </span>
                <form 
                    hx-post="/api/subscription-toggle"
                    hx-target="#subscription-section"
                    hx-swap="outerHTML"
                >
                    <input
                        type="hidden"
                        name="interestedInFutureEvents"
                        value={user.interestedInFutureEvents === false
                            ? "true"
                            : "false"}
                    />
                    <button
                        type="submit"
                        class="text-xs text-purple-600 hover:text-purple-800 font-medium underline cursor-pointer"
                    >
                        {
                            user.interestedInFutureEvents !== false
                                ? "Unsubscribe"
                                : "Subscribe"
                        }
                    </button>
                </form>
            </div>
        </div>

        <form method="POST" action={actions.signOut}>
            <button
                type="submit"
                class="w-full text-gray-600 font-medium py-2 px-4 rounded-md border border-gray-300 hover:bg-gray-50 transition-all"
            >
                Sign Out
            </button>
        </form>
    </div>
</div>
